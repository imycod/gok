<style>
    svg {
        width: 3.75em;
        animation: 1.5s spin ease infinite;
    }

    .ring {
        fill: none;
        stroke: hsla(341, 97%, 59%, 0.3);
        stroke-width: 2;
    }

    .ball {
        fill: #fc2f70;
        stroke: none;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .mask {
        width: 53px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 100;
    }
</style>

<div id="root">
  <router-view></router-view>
</div>
<script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.11/vue.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/vuex/3.6.0/vuex.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/vue-router/3.4.9/vue-router.js"></script>
<script>


const store = new Vuex.Store({
  state: {
    count: 1,
    listData: []
  },
  actions: {
    remote({commit}) {
      setTimeout(() => {
        fetch("./simple.json").then(res => res.json()).then(res => commit('setData', {res}));
      }, 3000);
    },
    inc({commit}) {
      setTimeout(() => {
        commit('inc');
      }, 1000);
    },
    dec({commit}) {
      commit('dec');
    }
  },
  getters: {
    getData(state) {
      return state.listData;
    }
  },
  mutations: {
    setData(state, payload) {
      state.listData = payload.res;
    },
    inc(state) {
      state.count++;
    },
    dec(state) {
      state.count--;
    }
  }
});
const Child = {
  computed: {
    count() {
      return store.state.count;
    },
    list() {
      return store.getters.getData;
    }
  },
  template: '<div>Child : {{count}} - {{list}}</div>'
};
const Parent = {
  template: `
    <div>
    <h3>Parent</h3>
    <button @click="asyncPlus">async +</button>
    <button @click="remote">remote</button>
    <button @click="show">show loading</button>
    <button @click="hide">hide loading</button>
    <hr>
    <Child></Child>
    </div>
  `,
  created() {
    this.remote();
  },
  methods: {
    show() {
      console.log('showshowshowshowshowshowshow');
      this.$loading.show();
    },
    hide() {
      console.log('hidehidehidehidehidehidehide');
      this.$loading.hide();
    },
    asyncPlus() {
      store.dispatch('inc');
    },
    async remote() {
      this.show();
      await store.dispatch('remote');
      this.hide();
    }
  },
  components: {
    Child
  }
};

const routes = [
  {
    path: '/',
    component: Parent
  },
];
const router = new VueRouter({
  routes
});


const Loading = {
  template: `
    <div v-show="finish" class="mask">
    <svg viewBox="0 0 50 50">
      <circle class="ring" cx="25" cy="25" r="20"></circle>
      <circle class="ball" cx="25" cy="5" r="3.5"></circle>
    </svg>
    </div>
  `,
  data() {
    return {
      finish: false
    };
  },
  methods: {
    show() {
      this.finish = true;
    },
    hide() {
      this.finish = false;
    }
  }
};


const loading = {
  install(Vue) {
    const LoadingConstructor = Vue.extend(Loading); // 将组件手动变成vue实例好手动调用组件实例对象的方法
    const loading = new LoadingConstructor();
    loading.$mount(document.body.appendChild(document.createElement('div')));
    document.body.appendChild(loading.$el);
    Vue.prototype.$loading = loading;
  }
};

Vue.use(loading);


//参数为对象类型
const vm = new Vue({
  el: "#root",
  store,
  router,
  data: {
    msg: "hello",
  },
  components: {
    Parent
  }
});
</script>
